<!DOCTYPE html>
<html>
<head>
  <title>Hitung Pajak</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .box { padding: 20px; border-radius: 8px; background: #f8f9fa; }
    .readonly-box { background: #e9ecef; }
  </style>
</head>
<body class="p-4">
  <div class="container">
    <h3 class="mb-3">Hitung Pajak</h3>

    <div class="row g-4">

      <div class="col-md-4 box">
        <div class="mb-3">
          <label class="form-label">Nama Jalan</label>
          <select id="jalan" class="form-select" onchange="loadData()">
            <option value="">Pilih</option>
            <option value="sudirman">Jenderal Sudirman</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Jenis Media</label>
          <select id="media" class="form-select" onchange="loadData()">
            <option value="">Pilih</option>
            <option value="BB">BB</option>
            <option value="BBJPO">BBJPO</option>
            <option value="PMNBNS">PMNBNS</option>
            <option value="BANNER">BANNER</option>
            <option value="FILM">FILM</option>
            <option value="VT">VT</option>
            <option value="BU">BU</option>
          </select>
        </div>

        <div id="inputUkuran" class="row g-2 mb-3">
          <div class="col">
            <label class="form-label">Panjang (m)</label>
            <input id="panjang" type="number" class="form-control" oninput="hitung()">
          </div>
          <div class="col">
            <label class="form-label">Lebar (m)</label>
            <input id="lebar" type="number" class="form-control" oninput="hitung()">
          </div>
        </div>

        <div id="inputBulan" class="mb-3">
          <label class="form-label">Lama Tayang Bulan</label>
          <select id="bulan" class="form-select" onchange="hitung()">
            <option value="">Pilih</option>
            <option value="3">3</option>
            <option value="12">12</option>
          </select>
        </div>

        <div id="inputBanner" class="mb-3" style="display:none">
          <label class="form-label">Tanggal Mulai</label>
          <input id="tglMulai" type="date" class="form-control mb-2" onchange="hitung()">
          <label class="form-label">Tanggal Selesai</label>
          <input id="tglSelesai" type="date" class="form-control" onchange="hitung()">
        </div>

        <div id="inputFilm" class="mb-3" style="display:none">
          <label class="form-label">Jumlah Tayang</label>
          <input id="tayang" type="number" class="form-control" oninput="hitung()">
        </div>

        <div id="inputBU" class="mb-3" style="display:none">
          <label class="form-label">Jumlah Balon</label>
          <input id="jmlBalon" type="number" class="form-control" oninput="hitung()">
          <div class="mt-2">
            <label class="form-label">Tanggal Mulai</label>
            <input id="tglMulaiBU" type="date" class="form-control mb-2" onchange="hitung()">
            <label class="form-label">Tanggal Selesai</label>
            <input id="tglSelesaiBU" type="date" class="form-control" onchange="hitung()">
          </div>
        </div>

      </div>

      <div class="col-md-8">
        <div class="box mb-3">
          <h5 class="mb-3">Tarif Pajak</h5>
          <table class="table table-bordered">
            <tbody id="tarifTable">
              <tr><td colspan="2" class="text-center">Pilih jalan dan media</td></tr>
            </tbody>
          </table>
        </div>

        <div class="box readonly-box">
          <h5>Total Pajak</h5>
          <h3 id="hasil" class="mt-2">0</h3>
          <p id="infoMinggu" class="fw-bold mt-2"></p>
        </div>
      </div>

    </div>
  </div>

<script>
  const tarif = {
    sudirman: {
      BB: { perMeter: 200, perTriwulan: 100 },
      BBJPO: { perMeter: 400, perTriwulan: 200 },
      PMNBNS: { perMeter: 100 },
      BANNER: { perMeter: 25 },
      FILM: { perTayang: 15 },
      VT: { perTriwulan: 125, perMeter: 250 },
      BU: { perUnit: 30 } // per balon per minggu
    }
  };

  function loadData() {
    const media = document.getElementById("media").value;

    // default visible
    document.getElementById("inputUkuran").style.display = "block";
    document.getElementById("inputBulan").style.display = "block";
    document.getElementById("inputBanner").style.display = "none";
    document.getElementById("inputFilm").style.display = "none";
    document.getElementById("inputBU").style.display = "none";

    if (media === "BANNER") {
      document.getElementById("inputBanner").style.display = "block";
      document.getElementById("inputBulan").style.display = "none";
    }

    if (media === "FILM") {
      document.getElementById("inputUkuran").style.display = "none";
      document.getElementById("inputFilm").style.display = "block";
      document.getElementById("inputBulan").style.display = "none";
    }

    if (media === "PMNBNS") {
      document.getElementById("bulan").value = "12";
      document.getElementById("inputBulan").style.display = "none";
    }

    if (media === "BU") {
      // BU tidak pakai panjang/lebih, tampilkan input balon + tanggal
      document.getElementById("inputUkuran").style.display = "none";
      document.getElementById("inputBulan").style.display = "none";
      document.getElementById("inputBU").style.display = "block";
    }

    renderTarif();
    hitung();
  }

  function renderTarif() {
    const jalan = document.getElementById("jalan").value;
    const media = document.getElementById("media").value;
    const tbody = document.getElementById("tarifTable");

    if (!jalan || !media) {
      tbody.innerHTML = `<tr><td colspan="2" class="text-center">Pilih jalan dan media</td></tr>`;
      return;
    }

    const data = tarif[jalan][media];
    let html = "";

    if (data.perMeter !== undefined) {
      html += `<tr><td>Per Meter (tahunan)</td><td>${data.perMeter}</td></tr>`;
    }
    if (data.perTriwulan !== undefined) {
      html += `<tr><td>Per Triwulan</td><td>${data.perTriwulan}</td></tr>`;
    }
    if (data.perTayang !== undefined) {
      html += `<tr><td>Per Tayang</td><td>${data.perTayang}</td></tr>`;
    }
    if (data.perUnit !== undefined) {
      html += `<tr><td>Per Balon per Minggu</td><td>${data.perUnit}</td></tr>`;
    }

    tbody.innerHTML = html || `<tr><td colspan="2" class="text-center">Data tarif tidak tersedia</td></tr>`;
  }

  // hitung hari inklusif: t1..t2 termasuk t1
  function daysInclusive(date1, date2) {
    // tanggal valid
    if (!date1 || !date2) return NaN;
    const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
    const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
    const msPerDay = 24 * 60 * 60 * 1000;
    return Math.floor((d2 - d1) / msPerDay) + 1;
  }

  function hitung() {
    const jalan = document.getElementById("jalan").value;
    const media = document.getElementById("media").value;
    const hasilEl = document.getElementById("hasil");
    const infoMingguEl = document.getElementById("infoMinggu");
    infoMingguEl.innerText = "";
    hasilEl.innerText = "0";

    if (!jalan || !media) return;

    const data = tarif[jalan][media];
    let total = 0;

    if (media === "FILM") {
      const tayang = parseInt(document.getElementById("tayang").value) || 0;
      total = tayang * (data.perTayang || 0);
    }
    else if (media === "BANNER") {
      const panjang = parseFloat(document.getElementById("panjang").value) || 0;
      const lebar = parseFloat(document.getElementById("lebar").value) || 0;
      const luas = panjang * lebar;

      const t1Val = document.getElementById("tglMulai").value;
      const t2Val = document.getElementById("tglSelesai").value;
      if (!t1Val || !t2Val) {
        hasilEl.innerText = "0";
        return;
      }
      const t1 = new Date(t1Val);
      const t2 = new Date(t2Val);
      if (isNaN(t1) || isNaN(t2) || t2 < t1) {
        hasilEl.innerText = "0";
        return;
      }

      const hari = daysInclusive(t1, t2); // inklusif
      const minggu = Math.ceil(hari / 7);

      infoMingguEl.innerText = "Minggu: " + minggu + " (Hari: " + hari + ")";
      total = luas * (data.perMeter || 0) * minggu;
    }
    else if (media === "BU") {
      const jmlBalon = parseInt(document.getElementById("jmlBalon").value) || 0;
      const t1Val = document.getElementById("tglMulaiBU").value;
      const t2Val = document.getElementById("tglSelesaiBU").value;
      if (!t1Val || !t2Val) {
        hasilEl.innerText = "0";
        return;
      }
      const t1 = new Date(t1Val);
      const t2 = new Date(t2Val);
      if (isNaN(t1) || isNaN(t2) || t2 < t1) {
        hasilEl.innerText = "0";
        return;
      }

      const hari = daysInclusive(t1, t2);
      const minggu = Math.ceil(hari / 7);

      infoMingguEl.innerText = "Minggu: " + minggu + " (Hari: " + hari + ")";
      total = jmlBalon * minggu * (data.perUnit || 0);
    }
    else { // BB, BBJPO, PMNBNS, VT (bulanan)
      const panjang = parseFloat(document.getElementById("panjang").value) || 0;
      const lebar = parseFloat(document.getElementById("lebar").value) || 0;
      const luas = panjang * lebar;

      let bulan = parseInt(document.getElementById("bulan").value) || 0;
      let tarifDipakai = 0;

      if (media === "PMNBNS") {
        // wajib tahunan
        tarifDipakai = data.perMeter || 0;
      } else {
        if (bulan === 3) tarifDipakai = data.perTriwulan || 0;
        if (bulan === 12) tarifDipakai = data.perMeter || 0;
      }

      total = luas * tarifDipakai;
    }

    // format angka sederhana
    hasilEl.innerText = total.toLocaleString('en-US', { maximumFractionDigits: 2 });
  }

  // event listeners tambahan untuk input tanpa atribut oninput
  document.addEventListener('input', function(e){
    // semua input yang relevan memicu hitung
    const ids = ['panjang','lebar','bulan','tglMulai','tglSelesai','tayang','jmlBalon','tglMulaiBU','tglSelesaiBU'];
    if (e.target && ids.includes(e.target.id)) hitung();
  });
  document.addEventListener('change', function(e){
    const ids = ['jalan','media'];
    if (e.target && ids.includes(e.target.id)) loadData();
  });
</script>

</body>
</html>
